sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/m/Dialog","sap/ui/core/Fragment","sap/m/library","sap/m/MessageToast"],function(e,t,n,o,g){"use strict";var a=o.ButtonType;var s=new sap.m.BusyDialog("oBusyDialog");let i;var r;const l=async function(e,t,n,o){debugger;console.log(e);let g=e.bindContext(`/${t}(...)`);g.setParameter(o,JSON.stringify(n));await g.execute();let a=g.getBoundContext();let s=a.getObject();if(s){return s.value}else{return""}};return e.extend("panappbeta.ext.controller.Form",{override:{onInit:async function(){debugger},onBeforeRendering:async function(){debugger;var e=this.base.getExtensionAPI().getModel();let t=this.base.getExtensionAPI();let n="InsertData";let o={some:"data"};debugger;let g=await l(e,n,o,"ID");console.log(g)},editFlow:{onAfterSave:async function(e){debugger;i=new sap.m.Dialog({title:"Confirm",content:new sap.m.Text({text:"   Submit PAN Form For Approval  "}),beginButton:new sap.m.Button({type:a.Emphasized,text:"OK",press:async function(){debugger;s.open();const e=this.base.getExtensionAPI().getModel();let t="sendforapproval";let n=window.location.href;var o=n.split("(");var a=o[1];var r=a.split("'");let d="https://btp-dev-0or0hi20.launchpad.cfapps.eu10.hana.ondemand.com/site?siteId=94a17d9a-05b5-425d-b51d-2cd74a2c2762#pan_approval-display?sap-ui-app-id-hint=saas_approuter_panapproval&/PAN_Details_APR('"+r[1]+"')";let c={url:d,PAN_Number:r[1],buttonclicked:"sendforApproval"};debugger;let m=await l(e,t,c,"data");let u=JSON.parse(m);console.log(u);i.close();i.destroy();g.show("PANForm Submitted for Approval");s.close();var p=await sap.ushell.Container.getServiceAsync("Navigation");p.navigate({target:{semanticObject:"obj1",action:"display"}});console.log(m)}.bind(this)}),endButton:new sap.m.Button({text:"Close",press:async function(){debugger;s.open();const e=this.base.getExtensionAPI().getModel();let t="getuserinfo";let n=window.location.href;var o=n.split("(");var g=o[1];var a=g.split("'");let r=a[1];debugger;let d=await l(e,t,r,"ID");i.close();i.destroy();s.close();var c=await sap.ushell.Container.getServiceAsync("Navigation");c.navigate({target:{semanticObject:"obj1",action:"display"}})}.bind(this)})});i.open()},onBeforeSave:async function(e){debugger;let t="draft";let n=e.context.getModel();let o=window.location.href;var g=o.split("(");var a=g[1];var s=a.split("'");let i=s[1];debugger;let r=await l(n,t,i,"ID");console.log(r)}},routing:{onBeforeBinding:async function(e){debugger;s.open();const t=this.base.getExtensionAPI().getModel();const n=this;let o=this.base.getExtensionAPI();let g="InsertData";let a={some:"data"};debugger;let i=await l(t,g,a,"ID");console.log(i);console.log(i);var d="getData";var c=window.location.href;var m=c.split("(");var u=m[1];var p=u.split("'");var b=p[1];var v=this.base.getAppComponent().getManifestObject()._oBaseUri._string;let f=v+`odata/v4/catalog/tab1?$filter=(PAN_Number%20eq%20%27${p[1]}%27)&$expand=tab1toWORKFLOW_HISTORY`;debugger;await $.ajax({url:f,success:function(e){debugger;console.log(e);h(e)},error:function(e,t,n){debugger;console.error(n)}});function h(e){debugger;var t=e.value[0].tab1toWORKFLOW_HISTORY;var o=[];t.forEach(e=>{debugger;o.push({Result:e.Result,level:e.level,Notification_Status:e.Notification_Status,Title:e.Title,Employee_ID:e.Employee_ID,Employee_Name:e.Employee_Name,"Begin_Date/_Time":e.Begin_DateAND_Time,"End_Date/_Time":e.End_DateAND_Time,Days_Taken:e.Days_Taken,Approved_by:e.Approved_by})});let g=n.base.getView().getContent()[0].getSections()[4];let a=o.sort((e,t)=>e.level>t.level?1:e.level<t.level?-1:0);let i=[];let d=[];let c;let m;let u=a.length-1;a.forEach((e,t)=>{c=e.level;if(m!=undefined){if(c!==m){i.push(d);d=[]}}d.push(e);m=e.level;if(t==u){i.push(d)}});g.destroySubSections();g.addSubSection(new sap.uxap.ObjectPageSubSection({}));let p=g.getSubSections();let b=p[p.length-1];try{b.addBlock(new sap.m.ScrollContainer({horizontal:true,vertical:true,visible:true,height:"400px"}))}catch(e){}let v=b.getBlocks()[0];v.addContent(new sap.m.HBox({width:"100%",alignItems:"End",alignContent:"End"}));let f=v.getContent();let h=f[f.length-1];h.addItem(new sap.m.HBox({width:"90%"}));h.addItem(new sap.m.Button({text:"Refresh",visible:!n.getView().getContent()[0].getHeaderTitle().mAggregations._actionsToolbar.getContent()[4].mProperties.visible,press:async function(e){console.log(e)}}));h.addItem(new sap.m.HBox({width:"1%"}));h.addItem(new sap.m.Button({text:"Comment History",press:async function(e){debugger;function t(){var e=Math.floor(Math.random()*1e6);var t=(new Date).getTime();var n=t+"-"+e;return n}if(!r){r=new sap.m.Dialog({title:"Approval Comments",endButton:new sap.m.Button({text:"Close",press:async function(){debugger;r.close()},layoutData:new sap.m.FlexItemData({growFactor:5,alignSelf:"End"})})})}r.addContent(new sap.m.VBox({width:"60vw"}));let n="getcomments";let o=e.getSource().getModel();console.log();var g=window.location.href;var a=g.split("(");var s=a[1];var i=s.split("'");var d=i[1];debugger;let c=await l(o,n,d,"ID");c=JSON.parse(c);const m=[];const u=c[0];if(u==undefined){debugger;r.getContent()[0].destroyItems();var p=new sap.suite.ui.commons.TimelineItem({text:"No Comments Found"});r.getContent()[0].addItem(p)}else{c.forEach(e=>{const t=e.createdAt;const n=e.createdBy;const o=e.modifiedAt;const g=e.modifiedBy;const a=e.idd;const s=e.PAN_Number;const i=e.user;const r=e.Comments;const l=e.status;m.push({firsname:i,lname:l,comment:r,dateTime:t})});r.getContent()[0].destroyItems();for(let e=0;e<m.length;e++){debugger;var p=new sap.suite.ui.commons.TimelineItem({id:`${"item"+t()}`,dateTime:`${m[e].dateTime}`,title:`${m[e].lname}`,userNameClickable:false,userNameClicked:"onUserNameClick",select:"onPressItems",userPicture:"Photo",text:`${m[e].comment}`,userName:`${m[e].firsname}`});r.mAggregations.content[0].addItem(p)}}r.open()}}));let w=0;i.forEach(e=>{v.addContent(new sap.uxap.ObjectPageSubSection({}));let t=v.getContent();let o=t[t.length-1];o.addBlock(new sap.m.VBox(`Box-${e[0].level}`));let g=o.getBlocks()[0];g.addItem(new sap.m.HBox({alignItems:"Center"}));let a=g.getItems()[0];a.addItem(new sap.m.Label({text:`Level ${e[0].level}`,design:"Bold"}));a.addItem(new sap.m.HBox({width:"40%"}));a.addItem(new sap.m.Label({text:`Notification: `}));debugger;if(n.getView().getContent()[0].getHeaderTitle().mAggregations._actionsToolbar.getContent()[4].mProperties.visible==true){a.addItem(new sap.m.Switch({enabled:!n.getView().getContent()[0].getHeaderTitle().mAggregations._actionsToolbar.getContent()[4].mProperties.visible,state:e[0].Notification_Status==="true",type:"AcceptReject",change:async function(e){debugger;console.log(e);s.open();let t=e.getSource().getParent().getItems()[0].mProperties.text;let n=t.split(" ");let o=n[1];let g="switch_control";let a=e.getSource().getModel();console.log();var i=window.location.href;var r=i.split("(");var d=r[1];var c=d.split("'");var m=c[1];var u={level:o,PAN_Number:m};debugger;let p=await l(a,g,u,"ID");console.log(p);s.close()}}))}else{if(!e[0].Result){a.addItem(new sap.m.Switch({enabled:true,state:e[0].Notification_Status==="true",type:"AcceptReject",change:async function(e){debugger;s.open();console.log(e);console.log(e);let t=e.getSource().getParent().getItems()[0].mProperties.text;let n=t.split(" ");let o=n[1];let g="switch_control";let a=e.getSource().getModel();console.log();var i=window.location.href;var r=i.split("(");var d=r[1];var c=d.split("'");var m=c[1];var u={level:o,PAN_Number:m};debugger;let p=await l(a,g,u,"ID");console.log(p);s.close()}}))}else{a.addItem(new sap.m.Switch({enabled:false,state:e[0].Notification_Status==="true",type:"AcceptReject",change:async function(e){s.open();console.log(e);console.log(e);let t=e.getSource().getParent().getItems()[0].mProperties.text;let n=t.split(" ");let o=n[1];let g="switch_control";let a=e.getSource().getModel();console.log();var i=window.location.href;var r=i.split("(");var d=r[1];var c=d.split("'");var m=c[1];var u={level:o,PAN_Number:m};debugger;let p=await l(a,g,u,"ID");console.log(p);s.close()}}))}}g.addItem(new sap.m.Table({visible:true}));let i=g.getItems()[1];let r=Object.keys(e[0]);r=r.slice(3);let d=[];r.forEach(e=>{if(!d.includes(e)){var t=new sap.m.Column({header:new sap.m.Label({text:e.replace(/_/g," ")}),width:"200px"});i.addColumn(t);d.push(e)}});e.forEach(e=>{let t=[];let n;let o=Object.values(e);o=o.slice(3);let g;o.forEach(e=>{g=new sap.m.Text({text:e});t.push(g)});n=new sap.m.ColumnListItem({cells:t});i.addItem(n)});w=w+1})}debugger;let w=await l(t,d,b,"ID");debugger;if(w==="Pending for Approval"||w==="Approved"||w==="Rejected"){n.getView().getContent()[0].getSections()[3].setVisible(false);this.getView().getContent()[0].getSections()[2].mAggregations._grid.getContent()[0].mAggregations._grid.getContent()[0].getContent().getItems()[1].getDependents()[1].mAggregations.headerToolbar.setVisible(false);n.getView().getContent()[0].setShowEditHeaderButton(false);n.getView().getContent()[0].getHeaderTitle().mAggregations._actionsToolbar.getContent()[4].setEnabled(false);n.getView().getContent()[0].getHeaderTitle().mAggregations._actionsToolbar.getContent()[4].setVisible(false)}else{if(this.getView().getContent()[0].getHeaderTitle().mAggregations._actionsToolbar.getContent()[4].mProperties.visible===true){debugger;n.getView().getContent()[0].getSections()[3].setVisible(false);this.getView().getContent()[0].getSections()[2].mAggregations._grid.getContent()[0].mAggregations._grid.getContent()[0].getContent().getItems()[1].getDependents()[1].mAggregations.headerToolbar.setVisible(false);n.getView().getContent()[0].setShowEditHeaderButton(true);n.getView().getContent()[0].getHeaderTitle().mAggregations._actionsToolbar.getContent()[4].setEnabled(true);n.getView().getContent()[0].getHeaderTitle().mAggregations._actionsToolbar.getContent()[4].setVisible(true)}}var C=this.base.getView().getContent()[0];function A(e){debugger;let t=sap.ui.getCore().byId(e).mAggregations.content.getContent().mAggregations.columns;t.forEach(t=>{let n=t.mProperties.dataProperty;let o=n.length;let g=sap.ui.getCore().byId(e).mAggregations.content.getContent().mAggregations._content.mBindingInfos.rows.binding.oCache.getValue();const a=Math.max(...g.map(e=>e[n]?.length??8));if(a>o)o=a;const s=(o+2)*8+20+"px";t.setWidth(s)})}debugger;A("__block1");A("__block2");debugger;function _(e){var t=sap.ui.getCore().byId(`${e}`).mAggregations._grid.mAggregations.content[0].getContent().getContent().getColumns();if(t!=undefined)t.forEach(t=>{var n=t.mProperties.dataProperty;var o=t.getHeader();var g=o.length;var a=sap.ui.getCore().byId(`${e}`).mAggregations._grid.mAggregations.content[0].getContent().getContent().mAggregations._content.mBindingInfos.rows.binding.oCache.getValue();const s=Math.max(...a.map(e=>e[n]?.length??8));if(s>g)g=s;const i=(g+2)*8+20+"px";t.setWidth(i)})}_("panappbeta::tab1ObjectPage--fe::FacetSubSection::VendorData");s.close()},onAfterBinding:function(e){debugger;var t=this.getView().getContent()[0].attachSectionChange(function(e){var t=e.getSource().mAggregations.sections[2].mAggregations._grid.mAggregations.content[0].mAggregations._grid.mAggregations.content[0].mAggregations.content.mAggregations.items[1].getItems();var n=e.getSource().mAggregations.headerTitle.mAggregations._actionsToolbar.getContent()[4].mProperties.visible;if(n==true){e.getSource().mAggregations.sections[2].mAggregations._grid.mAggregations.content[0].mAggregations._grid.mAggregations.content[0].mAggregations.content.getItems()[1].setUploadEnabled(false);for(let e=0;e<t.length;e++){t[e].setVisibleRemove(false);t[e].setEnabledRemove(false)}}else{e.getSource().mAggregations.sections[2].mAggregations._grid.mAggregations.content[0].mAggregations._grid.mAggregations.content[0].mAggregations.content.getItems()[1].setUploadEnabled(true);for(let e=0;e<t.length;e++){t[e].setVisibleRemove(true);t[e].setEnabledRemove(true)}}debugger});debugger;var n=this.getView().getContent()[0].getHeaderTitle().mAggregations._actionsToolbar.getContent()[4].mProperties.visible;let o=this.getView().getContent()[0].getSections()[2].mAggregations._grid.getContent()[0].mAggregations._grid.getContent()[0].getContent().getItems()[1].getItems();debugger;if(!n){this.getView().getContent()[0].getSections()[2].mAggregations._grid.getContent()[0].mAggregations._grid.getContent()[0].getContent().getItems()[1].setUploadEnabled(true);for(let e=0;e<o.length;e++){this.getView().getContent()[0].getSections()[2].mAggregations._grid.getContent()[0].mAggregations._grid.getContent()[0].getContent().getItems()[1].getDependents()[1].mAggregations.headerToolbar.setVisible(true);o[e].setVisibleRemove(true);o[e].setEnabledRemove(true)}}else{debugger;this.getView().getContent()[0].getSections()[2].mAggregations._grid.getContent()[0].mAggregations._grid.getContent()[0].getContent().getItems()[1].setUploadEnabled(false);for(let e=0;e<o.length;e++){this.getView().getContent()[0].getSections()[2].mAggregations._grid.getContent()[0].mAggregations._grid.getContent()[0].getContent().getItems()[1].getDependents()[1].mAggregations.headerToolbar.setVisible(false);o[e].setVisibleRemove(false);o[e].setEnabledRemove(false)}}debugger;var g=e.oBinding.sPath;const a=/PAN_Number='([^']+)'/;const s=g.match(a);let i=window.location.href;var r=i.split("(");var l=r[1];var d=l.split("'");const c=d[1];var m=this.base.getView().getContent()[0].getSections()[2].mAggregations._grid.getContent()[0].mAggregations._grid.getContent()[0].getContent().getItems()[1].mBindingInfos.items.binding;m.filter(new sap.ui.model.Filter({path:"PAN_Number",operator:sap.ui.model.FilterOperator.EQ,value1:c}))}}}})});